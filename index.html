<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>DEDU | FDV WHALE TRACKER</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root { --neon-green: #00ffa3; --dark-bg: #020105; }
        body { background-color: var(--dark-bg); color: white; font-family: 'Space+Mono', monospace; }
        .terminal-border { border: 1px solid #1e1b4b; background: #07070a; }
        .fdv-glow { text-shadow: 0 0 20px rgba(59, 130, 246, 0.5); color: #3b82f6; }
        iframe { width: 100%; height: 500px; border: none; }
    </style>
</head>
<body class="p-4 md:p-10">

    <div class="max-w-7xl mx-auto flex flex-col md:flex-row justify-between items-center mb-10 gap-6">
        <div class="flex items-center gap-5">
            <div class="w-16 h-16 border-2 border-[#00ffa3] flex items-center justify-center font-black text-[#00ffa3] italic bg-black text-3xl">D</div>
            <h1 class="text-3xl font-black italic tracking-tighter uppercase text-white">DEDU_DEFI_PROTOCOL</h1>
        </div>
        <div class="flex gap-2">
            <input id="tokenAddr" type="text" placeholder="MINT ADDRESS..." class="bg-black border border-blue-900/50 p-4 text-xs w-64 md:w-96 outline-none text-[#00ffa3]">
            <button onclick="startFdvTracker()" class="bg-[#00ffa3] text-black px-10 py-4 font-bold text-xs hover:bg-white transition-all uppercase italic">Track Whales</button>
        </div>
    </div>

    <div id="ui" class="max-w-7xl mx-auto hidden grid grid-cols-1 lg:grid-cols-4 gap-8">
        
        <div class="lg:col-span-3 space-y-6">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <div class="terminal-border p-6 rounded-xl text-center">
                    <p class="text-[10px] text-gray-500 uppercase mb-2">Current FDV</p>
                    <div id="fdvVal" class="text-3xl font-black fdv-glow">$0.00</div>
                </div>
                <div class="terminal-border p-6 rounded-xl text-center">
                    <p class="text-[10px] text-gray-500 uppercase mb-2">Top 50 Supply %</p>
                    <div id="whalePct" class="text-3xl font-black text-[#00ffa3]">0.00%</div>
                </div>
                <div id="sentimentBox" class="terminal-border p-6 rounded-xl text-center border-l-4 border-l-gray-700">
                    <p class="text-[10px] text-gray-500 uppercase mb-2">Whale Sentiment</p>
                    <div id="sentimentStatus" class="text-xl font-black uppercase">Neutral</div>
                </div>
            </div>

            <div class="terminal-border rounded-xl overflow-hidden">
                <iframe id="market-chart" src=""></iframe>
            </div>

            <div class="terminal-border p-10 rounded-xl bg-gradient-to-br from-[#0a0a1f] to-black border-l-4 border-l-blue-500">
                <h3 class="text-gray-500 text-[10px] font-bold mb-4 uppercase tracking-[0.4em]">// TOP_50_HOLDER_LOGIC</h3>
                <div id="logicLabel" class="text-4xl font-black uppercase italic text-white mb-4">Awaiting Snapshot...</div>
                <p id="logicSub" class="text-sm text-gray-400 italic">Tracking how top 50 holders movement impacts FDV stability.</p>
            </div>
        </div>
    </div>

    <script>
        const HELIUS_RPC = "https://mainnet.helius-rpc.com/?api-key=1a333300-f919-4d0e-ae4c-31b993844ba8";
        let initialWhaleBalance = null;

        async function startFdvTracker() {
            const mint = document.getElementById('tokenAddr').value.trim();
            if(!mint) return;

            document.getElementById('ui').classList.remove('hidden');
            document.getElementById('market-chart').src = `https://dexscreener.com/solana/${mint}?embed=1&theme=dark&trades=0&info=0`;

            updateData(mint);
            setInterval(() => updateData(mint), 15000); // 15s refresh
        }

        async function updateData(mint) {
            try {
                // 1. Get FDV from DexScreener
                const dexRes = await fetch(`https://api.dexscreener.com/latest/dex/tokens/${mint}`);
                const dexData = await dexRes.json();
                const pair = dexData.pairs[0];
                const currentFdv = pair.fdv;
                document.getElementById('fdvVal').innerText = "$" + currentFdv.toLocaleString();

                // 2. Get Top 50 Holders from RPC
                const rpcRes = await fetch(HELIUS_RPC, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ jsonrpc: "2.0", id: 1, method: "getTokenLargestAccounts", params: [mint] })
                });
                const rpcData = await rpcRes.json();
                
                if (rpcData.result) {
                    let top50Sum = 0;
                    rpcData.result.value.slice(0, 50).forEach(acc => top50Sum += acc.uiAmount);
                    
                    // Mock Supply (Assumes 1B for most Solana memes, update if needed)
                    const whaleShare = ((top50Sum / 1000000000) * 100).toFixed(2);
                    document.getElementById('whalePct').innerText = whaleShare + "%";

                    if (initialWhaleBalance === null) initialWhaleBalance = top50Sum;
                    
                    const whaleDelta = (((top50Sum - initialWhaleBalance) / initialWhaleBalance) * 100).toFixed(4);
                    applyWhaleLogic(whaleDelta, whaleShare);
                }
            } catch (e) { console.error("Whale Sync Error"); }
        }

        function applyWhaleLogic(delta, share) {
            const label = document.getElementById('logicLabel');
            const sub = document.getElementById('logicSub');
            const sBox = document.getElementById('sentimentBox');
            const sStatus = document.getElementById('sentimentStatus');

            if (delta < -0.5) { // If top 50 holders sold 0.5% of total supply
                label.innerText = "RUG_SIGNAL: WHALES EXITING";
                label.className = "text-4xl font-black uppercase italic text-red-500";
                sub.innerText = "Top 50 holders are reducing bags. Expect FDV decay. Wait for another farmer to call.";
                sStatus.innerText = "Bearish";
                sBox.style.borderLeftColor = "#ef4444";
            } else if (delta > 0.5) {
                label.innerText = "FOMO SESSION: WHALE ACCUMULATION";
                label.className = "text-4xl font-black uppercase italic text-[#00ffa3]";
                sub.innerText = "Top 50 holders are increasing positions. High FDV growth potential.";
                sStatus.innerText = "Bullish";
                sBox.style.borderLeftColor = "#00ffa3";
            } else if (share > 70) {
                label.innerText = "OVERBOUGHT: CENTRALIZED RISK";
                label.className = "text-4xl font-black uppercase italic text-yellow-500";
                sub.innerText = "Top 50 holders own >70%. High risk of 'farming' on retail soon.";
                sStatus.innerText = "CUTION";
                sBox.style.borderLeftColor = "#eab308";
            } else {
                label.innerText = "STABLE FLOW: NO WHALE ACTION";
                label.className = "text-4xl font-black uppercase italic text-white";
                sub.innerText = "Whale balances are steady. Price movement is currently retail-driven.";
                sStatus.innerText = "Neutral";
                sBox.style.borderLeftColor = "#374151";
            }
        }
    </script>
</body>
</html>
